{% load tcgcreatorlookup %}
<html>
<head>
<meta charset="utf-8">
<style>
.control input[type="button"]{
	height: 30px;
}
table .field td{
	border-collapse:separate;
	border:1px solid;
        text-align:center;
	width:120px;
	height:10px;
        padding-left:1px;
        padding-right:1px;
	}
div .field{
	border:1px solid;
        text-align:center;
	width:120px;
	height:10px;
        margin:0px;
        padding:0px;
}
table .field{
        margin:0px;
}
table .card td{
	border-collapse:separate;
	border:1px solid;
	width:120px;
	height:10px;
	}
</style>
{% load static %}
<script type="text/javascript" src="{% static 'js/jquery.min.js'%}"></script>
<script type="text/javascript" src="{% static 'js/ajax.js'%}"></script>
<script type="text/javascript">
        var mine_color = "{{Config.mine_color}}";
        var other_color = "{{Config.other_color}}";
	var static_url = "{% get_static_prefix %}/tcgcreator";
	var gray_out = "{{gray_out.monster_variable_name}}";
	var field_free = "{{field_free}}";
	var show_img = true;
	var music= new Audio();
	var sound_effect =  new Audio();
	var sound_effect_name =  "";
	var music_name ="";
	var game_field;
	var timer = 0;
	var timer_id;
	var timer_for_win_and_lose=0;
	var multiple_number = 0;
	var global_data = "";
	var stored_data = null;
	var prompt;
	function checkVal(monster,variable){
	    var value = monster["variables"][variable]["value"];
	    if( monster["eternal"] == undefined){
	        return value
	    }

        for( i=0;i<monster["eternal"].length;i++){
                if (!monster["eternal"][i]){
                    continue
                }
                if(monster["eternal"][i]["variables"][variable] != undefined){
                        value+=parseInt(monster["eternal"][i]["variables"][variable]["value"]);
                }
        }
        return value;
	}
	function SendMessage(){
	    var message = $("#tomessage").val();
	    $("#tomessage").val("");
    Success2();
	$.ajax({
   type: "POST",
   url: "{% url 'tcgcreator:send_message'  %}",
   data: "room_number={{room_number}}&message="+message,
success: function(data){
    var tmp = {};
	data = JSON.parse(data);
    tmp["log"] = data["log"];
    tmp["message_log"] = data["message_log"];
	WriteLog(tmp);
	    Wait();
   },
   error:function(){
		alert("error");
	}
	});
	}
	function Wait(){
    Success2();
	$.ajax({
   type: "POST",
   url: "{% url 'tcgcreator:battle_det'  %}",
   data: "room_number={{room_number}}",
success: function(data){
    if(data == "waiting"){
        clearTimeout(timer);
	    timer = setTimeout(Wait,1000);
	    return;
    }else{
	    Success(data);
	}
   },
   error:function(){
		alert("error");
	}

 });
	}
	$(document).ready(function(){
	if({{Config.message_position}} != 1){
        $("#log").hide();
	}else{
        $("#log2").hide();
	}
	$.ajax({
   type: "POST",
   url: "{% url 'tcgcreator:battle_det'  %}",
   data: "room_number={{room_number}}",
success: function(data){
    if(data == "waiting"){
        clearTimeout(timer);
	    timer = setTimeout(Wait,1000);
	    return;
    }
	Success(data);
   },
   error:function(){
		alert("error");
	}
	
 });
});
function cancel(){
    Success2();
	$.ajax({
   type: "POST",
   url: "{% url 'tcgcreator:battle_det'  %}",
   data: "room_number={{room_number}}",
success: function(data){
    if(data == "waiting"){
        clearTimeout(timer);
	    timer = setTimeout(Wait,1000);
	    return;
    }else{
	    Success(data);
	}
   },
   error:function(){
		alert("error");
	}
});
}
function none(){
    Success2();
	$.ajax({
   type: "POST",
   url: "{% url 'tcgcreator:battle_det'  %}",
   data: "room_number={{room_number}}",
success: function(data){
    if(data == "waiting"){
        clearTimeout(timer);
	    timer = setTimeout(Wait,1000);
	    return;
    }else{
	Success(data);
	}
   },
   error:function(){
		alert("error");
	}
});
}
// 一度選択後に表示
function ask_det2(type,k,l,under_id = ""){
    //一度選択をクリア
    Success2();
    $("#message").html("");
	data = global_ask_data;
	var tmp = {};
	if(type=="player"){
	    tmp["val"] = k;
	    tmp["type"] = "player";
		global_all_result.push(tmp);
		if(k == "own"){
		    global_answer_own_player = true;
		}else if(k== "other"){
		    global_answer_other_player = true;
		}
	}
	if(type == "deck"){
		global_answer_deck.push(k+"_"+l);
		tmp["val"] = k+"_"+l;
		tmp["type"] = "deck";;
		global_all_result.push(tmp);
	}else if(type == "grave"){
		global_answer_grave.push(k+"_"+l);
		tmp["val"] = k+"_"+l;
		tmp["type"] = "grave";;
		global_all_result.push(tmp);
	}else if(type == "hand"){
		global_answer_hand.push(k+"_"+l);
		tmp["val"] = k+"_"+l;
		tmp["type"] = "hand";;
		global_all_result.push(tmp);
	}else if(type == "field"){
		global_ask_fields.push(k+"_"+l);
		tmp["val"] = k+"_"+l;
		tmp["type"] = "field";;
		global_all_result.push(tmp);
	}else if(type == "under"){
	    tmp = {}
	    tmp["x_and_y"] = k+"_"+l;
	    tmp["under_id"] = under_id;
		global_ask_unders.push(tmp);
		tmp["val"] = k+"_"+l;
		tmp["under_id"] = under_id;
		tmp["type"] = "under";;
		global_all_result.push(tmp);
	}
	min_equation_number = data["min_equation_number"];
	max_equation_number = data["max_equation_number"];
	if(global_all_result.length == max_equation_number){
		sendAnswer();
		return;
	}
	if(data["own_player"] == true && global_answer_own_player == false){
	    $("#own_player").html("<input type=¥"button¥" onclick=¥"ask_det2('player','own','');
	}
	if(data["other_player"] == true && global_answer_other_player == false){
	    $("#other_player").html("<input type=¥"button¥" onclick=¥"ask_det2('player','other','');
	}
	equation_kind = data["equation_kind"];
	result_html =prompt+"<br>";
	data = data["return_val"];
	result_html = "";
	decks = [];
	graves = [];
	hands = [];
	// フィールドで複数回ループが回るときよう
	global_ask_fields2 = [];
	var i,j;
	$("#end_chain").hide();
	global_field_fields = null;
	for(i = 0;i<data.length;i++){
		if(data[i]["field"] != undefined){
			MakeFieldsChoose(data[i])
		}else{
			result_html += data[i]["mine_or_other"]+"<br>";
		}
		if(data[i]["cards"] != undefined){
			tmp_det  = [];
			for(j=0;j<data[i]["cards"].length;j++){
				if($.inArray(i+"_"+j,global_answer_deck) == -1){
					if(Validate(data[i]["cards"][j])){
						result_html += "<input type=\"button\" onclick=\"ask_det2('deck',"+i+","+j+")\" value=\""+data[i]["cards"][j]["monster_name"]+"\">";;
					}
				}
			}
		}
		if(data[i]["grave"] != undefined){
			tmp_det  = [];
			for(j=0;j<data[i]["grave"].length;j++){
				if($.inArray(i+"_"+j,global_answer_grave) == -1){
					if(Validate(data[i]["grave"][j])){
						result_html += "<input type=\"button\" onclick=\"ask_det2('grave',"+i+","+j+")\" value=\""+data[i]["grave"][j]["monster_name"]+"\">";;
					}
				}
			}
		}
		if(data[i]["hand"] != undefined){
			tmp_det  = [];
			for(j=0;j<data[i]["hand"].length;j++){
				if($.inArray(i+"_"+j,global_answer_hand) == -1){
					if(Validate(data[i]["hand"][j])){
						result_html_hand = "<br><input type=\"button\" onclick=\"ask_det2('hand',"+i+","+j+")\" value=\""+data[i]["hand"][j]["monster_name"]+"\">";;
				        $("#"+data[i]["hand"][j]["place_unique_id"]).after(result_html_hand);
					}
				}
			}
		}
	}
	result_html += "<input type=\"button\" value=\"選択完了\" onclick=\"sendAnswer()\">";
	$("#message").html(result_html);
}

function AnswerYesOrNo(data){
    if(data == undefined){
        data = global_data;
    }
    global_data = data;
    Success2();
	$.ajax({
   type: "POST",
   url: "{% url 'tcgcreator:yes_or_no'  %}",
   data: "room_number={{room_number}}&answer="+data,
success: function(data){
    if(data == "error"){
            alert("正しい対象を選択してくだい。");
        }
    if(data == "waiting"){
        clearTimeout(timer);
	    timer = setTimeout(AnswerYesOrNo,1000);
	    return;
    }else{
	    Success(data);
	}
   },
   error:function(){
		alert("error");
	}
});
}
function AnswerChainVariable(min,max){
    if(min == undefined || max == undefined){
        min= global_data["min"];
        max= global_data["max"];
    }
    global_data = {};
    global_data["min"] =min;
    global_data["max"] =max;
    global_data = data;
    chain_variable = $("#chain_variable").val();
    if(chain_variable <min || chain_variable > max){
		alert("選択できるのは"+min+"以上"+max+"以下です");
		ask();
		return;
    }
    Success2();
	$.ajax({
   type: "POST",
   url: "{% url 'tcgcreator:chain_variable'  %}",
   data: "room_number={{room_number}}&chain_variable="+chain_variable,
success: function(data){
    if(data == "waiting"){
        clearTimeout(timer);
	    timer = setTimeout(AnswerChangeVariable,1000);
	    return;
    }else{
	    Success(data);
	}
   },
   error:function(){
		alert("error");
	}
});
}
function YesOrNoDet(data){
	sentence = data["prompt"];
	result_html = sentence+"<br>";
	result_html += "<input type=\"button\" value=\"はい\" onclick=\"AnswerYesOrNo('yes')\"><input type=\"button\" value=\"いいえ\" onclick=\"AnswerYesOrNo('no')\">";
	$("#message").html(result_html);
}
function ChooseOrder(i){
    global_order.push(i);
    ValOrderDet(null);
}
function ValOrderDet(data){
    if(data!= null ){
        prompt = data["prompt"];
        global_data = data["variables"];
    }
    result_html = prompt;
    if(global_order.length == global_data.length){
        sendAnswerOrder();
    }
    for(var i=0;i<global_data.length;i++){
	    if($.inArray(i,global_order) == -1){
	        result_html += '<input type="button" value="'+global_data[i]["monster_name"]+' '+ global_data[i]["change_val"]+'" onclick="ChooseOrder('+i+')">';
	    }
    }
	$("#message").html(result_html);
}
function ChainVariableDet(data){
	var prompt = data["prompt"];
	result_html = prompt+"<br>";
	result_html += "<input type=\"number\" id=\"chain_variable\" value=\""+data["min"]+"\"> <input type=\"button\" value=\"選択完了\" onclick=\"AnswerChainVariable("+data["min"]+","+data["max"]+")\">";
	$("#message").html(result_html);
}
function ShowChooseMonster(monster){
    if(monster["place"] == "field"){
        ShowChooseMonsterField(monster);
    }
}
function ShowChooseMonsterField(monster){
	    if(monster["place"] == "field"){
		var fields = global_field_fields;
		var x = monster["x"];
	    var y = monster["y"];
		result="<table><tr><td style=\"border:1px solid red\"><a target=\"_blank\" title=\""+fields[x][y]["det"]["monster_sentence"]+"\" href=\"{% url "tcgcreator:explain"%}?id="+fields[x][y]["det"]["id"]+"\"> <img src=\""+static_url+"/img/"+fields[x][y]["det"]["img"]+"\" width=\"100px\" height=\"140px\" ></a></td></tr></table>";
		if(user == 1){
			$("#"+x+"_"+y).html(result);
		}else{
			$("#"+x+"_"+({{field_y}}-y-1)).html(result);
		}
		    }
}
function ChooseMultiple(data){
    multiple_answer = [];
	min_equation_number = data["min_equation_number"];
	max_equation_number = data["max_equation_number"];
	prompt = data["prompt"];
	double = data["double"];
	user = data["user"];
	data2 = data["return_val"];
        console.log(data2);
	current_choice_array = [];
	global_choosed_monster = data2[0];
	if(global_choosed_monster.length==0){
        sendMultipleAnswer([]);
        return;
    }
	global_field_sentence = data["sentence"];
	global_prompt = data["prompt"];
	result_html = global_field_sentence+"<br>";
	result_html += global_choosed_monster[multiple_number]["det"]["monster_name"]+global_prompt;
	ShowFieldMuptiple(global_choosed_monster[multiple_number]["det"]["place_unique_id"]);
	choosed_data = JSON.stringify(data2[1]);
	if(min_equation_number == 0){
	    result_html += "<input type=\"button\" value=\"{{Config.choose_multiple_cancel }}\" onclick=\"choosed('')\">";
	}
	$("#message").html(result_html);
	ShowChooseMonster(global_choosed_monster[multiple_number]);
	global_to_monsters = data2[1];
	ChooseMonsterForMultiple("");
}
function choosed(data){
    //一度選択をクリア
    Success2();
        multiple_answer.push(current_choice_array.slice(1));
        multiple_number += 1;
        if(global_choosed_monster[multiple_number] == undefined){
            sendMultipleAnswer(multiple_answer);
            return;
        }
	    ShowChooseMonster(global_choosed_monster[multiple_number]);
	    result_html = global_field_sentence+"<br>";
	    result_html += global_choosed_monster[multiple_number]["det"]["monster_name"]+global_prompt;
	if(min_equation_number == 0){
	    result_html += "<input type=\"button\" value=\"迎撃しない\" onclick=\"choosed('')\">";
	}
	    $("#message").html(result_html);
    current_choice_array = [];
    ChooseMonsterForMultiple("");

}
function ChooseMonsterForMultiple(current_choice){
    var to_monsters = global_to_monsters;

    if(current_choice != ""){
        current_choice_array = current_choice.split("_");
    }else{
        current_choice_array = [];
    }
    if(current_choice_array.length>= max_equation_number){
        multiple_answer.push(current_choice_array[0]);
        multiple_number += 1;
        if(global_choosed_monster[multiple_number] == undefined){
            sendMultipleAnswer(multiple_answer);
            return;
        }
	    ShowChooseMonster(global_choosed_monster[multiple_number]);
	    result_html = global_field_sentence+"<br>";
	    result_html += global_choosed_monster[multiple_number]["det"]["monster_name"]+prompt;
	    if(min_equation_number == 0){
	        result_html += "<input type=\"button\" value=\"選択完了\" onclick=\"choosed('')\">";
	    }
    }
    result_html_hand = {};
    result_html_grave = {};
    result_html_deck = {};

    //一度選択をクリア
    Success2();
	    ShowFieldMuptiple(global_choosed_monster[multiple_number]["det"]["place_unique_id"]);
    for(var i=0;i<to_monsters.length;i++){
        var none_flag = false;
        for(var j=0;j<multiple_number;j++){
		    if($.inArray(String(i),multiple_answer[j]) != -1){
		        none_flag = true;
		        break;
		    }
		}
		if($.inArray(String(i),current_choice_array && double == false) != -1){
		    continue;
		}
		if(none_flag == true && double == false){
		    continue;
		}
        if(to_monsters[i]["place"] == "field"){
		var fields = global_field_fields;
		var x = to_monsters[i]["x"];
	    var y = to_monsters[i]["y"];
	    if(fields[x][y]["det"] == undefined){
		    result="<table><tr><td style=\"\"><input type=\"button\" onclick=\"ChooseMonsterForMultiple("+String(i)+")\" value=\"ここ\"></td></tr></table>";

		}else{
	        result="<table><tr><td style=\"\"><a target=\"_blank\" title=\""+fields[x][y]["det"]["monster_sentence"]+"\"  href=\"{% url "tcgcreator:explain"%}?id="+fields[x][y]["det"]["id"]+"\"> <img src=\""+static_url+"/img/"+fields[x][y]["det"]["img"]+"\" width=\"100px\" height=\"140px\" ></a><br><input type=\"button\" onclick=\"ChooseMonsterForMultiple('"+String(i)+"')\" value=\""+fields[x][y]["det"]["monster_name"]+"\"></td></tr></table>";
		}
		if(user == 1){
			$("#"+x+"_"+y).html(result);
		}else{
			$("#"+x+"_"+({{field_y}}-y-1)).html(result);
		}
        }
        if(to_monsters[i]["place"] == "hand"){

			if($("#"+data[i]["hand"][j]["place_unique_id"]).length != 0){
				result_html_hand = "<br><input type=\"button\" onclick=\"ChooseMonsterForMultiple('"+String(i)+"')\" value=\""+data[i]["hand"][j]["monster_name"]+"\">";;
			    $("#"+data[i]["hand"][j]["place_unique_id"]).html();
			}else{
            if(result_html_hand[to_monsters["deck_id"]][to_monsters["mine_or_other"]] == undefined){
                result_html_hand[to_monsters["deck_id"]][to_monsters["mine_or_other"]] = hands[to_monsters["deck_id"]].hand_name;
            }
			result_html_hand[to_monsters["deck_id"]][to_monsters["mine_or_other"]] += "<input type=\"button\" onclick=\"ChooseMonsterForMultiple('"+String(i)+"')\" value=\""+to_monsters[i]["det"]["monster_name"]+"\">";;
			}
		}
        if(to_monsters[i]["place"] == "deck"){
            if(result_html_deck[to_monsters["deck_id"]][to_monsters["mine_or_other"]] == undefined){
                result_html_deck[to_monsters["deck_id"]][to_monsters["mine_or_other"]] = decks[to_monsters["deck_id"]].deck_name;
            }
			result_html_deck[to_monsters["deck_id"]][to_monsters["mine_or_other"]] += "<input type=\"button\" onclick=\"ChooseMonsterForMultiple('"+String(i)+"')\" value=\""+to_monsters[i]["det"]["monster_name"]+"\">";;
		}
        if(to_monsters[i]["place"] == "grave"){
            if(result_html_grave[to_monsters["deck_id"]][to_monsters["mine_or_other"]] == undefined){
                result_html_grave[to_monsters["deck_id"]][to_monsters["mine_or_other"]] = graves[to_monsters["deck_id"]].grave_name;
            }
			result_html_grave[to_monsters["deck_id"]][to_monsters["mine_or_other"]] += "<input type=\"button\" onclick=\"ChooseMonsterForMultiple('"+String(i)+"')\" value=\""+to_monsters[i]["det"]["monster_name"]+"\">";;
		}
    }
    for(var tmp in  result_html_deck){
        result_html += tmp
    }
    for(var tmp in  result_html_grave){
        result_html += tmp
    }
    for(var tmp in  result_html_hand){
        result_html += tmp
    }
    $("#message").html(result_html);
}
function ask_det(data){
	Success2();
	global_all_result = [];
	data = JSON.parse(data);
	console.log(data);
	if(data["own_player"] == true){
	    $("#own_player").html("<input type=¥"button¥" onclick=¥"ask_det2('player','own','');
	}
	if(data["other_player"] == true){
	    $("#other_player").html("<input type=¥"button¥" onclick=¥"ask_det2('player','other','');
	}
	if(data["chain_variable"] == true){
	   ChainVariableDet(data);
           return;
	}
	if(data["force_effect"] == true){
	   ForceEffect(data["return_val"]);
           return;
	}
	if(data["val_order"] == true){
	    global_order = [];
	   ValOrderDet(data);
           return;
	}
	if(data["yes_or_no"] == true){
	   YesOrNoDet(data);
           return;
	}
	if(data["multiple"] == true){
	   multiple_number = 0;
	   console.log(data);
	   ChooseMultiple(data);
           return;
	}
	global_ask_data = data;
	global_answer_deck = [];
	global_answer_own_player = false;
	global_answer_other_player = false;
	global_answer_grave = [];
	global_answer_hand = [];
	global_ask_fields= [];
	global_ask_unders= [];
	min_equation_number = data["min_equation_number"];
	max_equation_number = data["max_equation_number"];
	global_field_whether_monster = data["whether_monster"];
	global_field_sentence = data["sentence"];
	equation_kind = data["equation_kind"];
	monster_name_kind = data["monster_name_kind"];
	if(data["variables"] != undefined){
    	variables = data["variables"];
    }else{
    	variables = Array();
    }
	if(data["flag"] != undefined){
		flag = data["flag"];
	}else{
		flag = false;
	}
	exclude = data["exclude"];
	
	prompt = data["prompt"];
	data = data["return_val"];
	result_html = "";
	decks = [];
	graves = [];
	hands = [];
	global_ask_fields = [];
	global_ask_unders= [];
	// フィールドで複数回ループが回るときよう
	global_ask_fields2 = [];
	var i,j;
	result_html = prompt+"<br>";
	$("#end_chain").hide();
	console.log(data[0]["field"]);
	for(i = 0;i<data.length;i++){
		if(data[i]["field"] != undefined){
			MakeFieldsChoose(data[i]);
		}else{
			result_html += data[i]["mine_or_other"]+"<br>";
		}
		if(data[i]["cards"] != undefined){
			tmp_det  = [];
			for(j=0;j<data[i]["cards"].length;j++){
				if(Validate(data[i]["cards"][j])){
				result_html += "<input type=\"button\" onclick=\"ask_det2('deck',"+i+","+j+")\" value=\""+data[i]["cards"][j]["monster_name"]+"\">";;
				}
				tmp= data[i]["cards"][j];
				tmp["type"] = "deck";
				tmp["mine_or_other"] = data[i]["mine_or_other_val"];
				tmp_det.push(tmp);
			}
			tmp2 = {};
			tmp2["key"] = data[i]["deck_id"];
			tmp2["val"]= j;
			tmp2["det"]= tmp_det;
			decks.push(tmp2);
		}
		if(data[i]["grave"] != undefined){
			tmp_det  = [];
			for(j=0;j<data[i]["grave"].length;j++){
				if(Validate(data[i]["grave"][j])){
				result_html += "<input type=\"button\" onclick=\"ask_det2('grave',"+i+","+j+")\" value=\""+data[i]["grave"][j]["monster_name"]+"\">";;
				}
				tmp = data[i]["grave"][j];
				tmp["type"] = "grave";
				tmp["mine_or_other"] = data[i]["mine_or_other_val"];
				tmp_det.push(tmp);
			}
			tmp2 = {};
			tmp2["key"] = data[i]["grave_id"];
			tmp2["val"]= j;
			tmp2["det"]= tmp_det;
			graves.push(tmp2);
		}
		if(data[i]["hand"] != undefined){
			tmp_det  = [];
			for(j=0;j<data[i]["hand"].length;j++){
				if(Validate(data[i]["hand"][j])){
				    if($("#"+data[i]["hand"][j]["place_unique_id"]).length>0){
				        result_html_hand = "<br><input type=\"button\" onclick=\"ask_det2('hand',"+i+","+j+")\" value=\""+data[i]["hand"][j]["monster_name"]+"\">";;
				        $("#"+data[i]["hand"][j]["place_unique_id"]).after(result_html_hand);
				    }else{
				        result_html += "<input type=\"button\" onclick=\"ask_det2('hand',"+i+","+j+")\" value=\""+data[i]["hand"][j]["monster_name"]+"\">";
			        }
			    }
				tmp = data[i]["hand"][j];
				tmp["type"] = "hand";
				tmp["mine_or_other"] = data[i]["mine_or_other_val"];
				tmp_det.push(tmp);
			}
			tmp2 = {};
			tmp2["key"] = data[i]["hand_id"];
			tmp2["val"]= j;
			tmp2["det"]= tmp_det;
			hands.push(tmp2);
		}
	}
	global_ask_decks = decks;
	global_ask_graves = graves;
	global_ask_hands = hands;
	result_html += "<input type=\"button\" value=\"選択完了\" onclick=\"sendAnswer()\">";
	$("#message").html(result_html);
}
function ForceEffect(data){
    var i;
    var result_html = "";
    for(i=0;i<data.length;i++){
		if(data[i]["able"] == 1){
			result_html += "<input type=\"button\" onclick=\"SendForceEffect('"+data[i]["det"]["place_unique_id"]+"')\" value=\""+data[i]["det"]["monster_name"]+"\">";
		}else{
			result_html += "("+data[i]["det"]["monster_name"]+")";
		}
    }
	$("#message").html(result_html);
}
function SendForceEffect(id){
    Success2();
	$.ajax({
   type: "POST",
   url: "{% url 'tcgcreator:force_trigger'  %}",
   data: "room_number={{room_number}}&place_unique_id="+id,
success: function(data){
    if(data == "waiting"){
        clearTimeout(timer);
        timer = setTimeout(InvokeChoice,1000);
        return;
    }
	Success(data);
   },
   error:function(){
		alert("error");
	}

 });
}
function InvokeChoice(id){
    if(id == undefined){
        id = global_data;
    }
    global_data = id;
    Success2();
	$.ajax({
   type: "POST",
   url: "{% url 'tcgcreator:choices'  %}",
   data: "room_number={{room_number}}&trigger_id="+id,
success: function(data){
    if(data == "waiting"){
        clearTimeout(timer);
        timer = setTimeout(InvokeChoice,1000);
        return;
    }
	InvokeChoiceDet(data);
   },
   error:function(){
		alert("error");
	}

 });
}
function InvokeChoiceDet(data){
    Success2();
	$.ajax({
   type: "POST",
   url: "{% url 'tcgcreator:battle_det'  %}",
   data: "room_number={{room_number}}",
success: function(data){
    if(data == "waiting"){
        clearTimeout(timer);
	    timer = setTimeout(InvokeChoiceDet,1000);
	    return;
    }else{
	    Success(data);
	}
   },
   error:function(){
		alert("error");
	}
});
}
function sendFieldTrigger(x,y,place_unique_id,trigger_id,mine_or_other){
    if(x==undefined || y == undefined || place_unique_id == undefined || trigger_id == undefined || mine_or_other == undefined || mine_or_other == undefined){
        x = global_data["x"];
        y = global_data["y"];
        place_unique_id = global_data["place_unique_id"];
        trigger_id = global_data["trigger_id"];
        mine_or_other = global_data["mine_or_other"];
    }
    global_data = {};
    global_data["x"] = x;
    global_data["y"] = y;
    global_data["place_unique_id"] = place_unique_id;
    global_data["trigger_id"] = trigger_id;
    global_data["mine_or_other"] = mine_or_other;
    Success2();
	$.ajax({
   type: "POST",
   url: "{% url 'tcgcreator:field_trigger'  %}",
   data: "room_number={{room_number}}&trigger_id="+trigger_id+"&x="+x+"&y="+y+"&place_unique_id="+place_unique_id+"&mine_or_other="+mine_or_other,
success: function(data){
    if(data == "waiting"){
        clearTimeout(timer);
        timer = setTimeout(sendFieldTrigger,1000);
        return;
    }
	sendFieldTriggerDet(data);
   },
   error:function(){
		alert("error");
	}

 });
}
function sendDeckTrigger(deck_id,place_unique_id,trigger_id,mine_or_other){
    if(deck_id == undefined){
        deck_id= global_data["deck_id"];
        place_unique_id= global_data["place_unique_id"];
        mine_or_other =  global_data["mine_or_other"];
        trigger_id == global_data["trigger_id"];
    }
    global_data = {};
    global_data["deck_id"] = deck_id;
    global_data["place_unique_id"] = place_unique_id;
    global_data["mine_or_other"] = mine_or_other;
    global_data["trigger_id"] = trigger_id;
    Success2();
	$.ajax({
   type: "POST",
   url: "{% url 'tcgcreator:deck_trigger'  %}",
   data: "room_number={{room_number}}&trigger_id="+trigger_id+"&deck_id="+deck_id+"&place_unique_id="+place_unique_id+"&mine_or_other="+mine_or_other,
success: function(data){
    if(data == "waiting"){
        clearTimeout(timer);
	    timer = setTimeout(sendHandTrigger,1000);
	    return;
    }else{
	sendHandTriggerDet(data);
	}
   },
   error:function(){
		alert("error");
	}

 });
}
function sendHandTrigger(hand_id,place_unique_id,trigger_id,mine_or_other){
    if(hand_id == undefined){
        hand_id= global_data["hand_id"];
        trigger_id= global_data["trigger_id"];
        place_unique_id= global_data["place_unique_id"];
        mine_or_other =  global_data["mine_or_other"];
    }
    global_data = {};
    global_data["hand_id"] = hand_id;
    global_data["trigger_id"] = trigger_id;
    global_data["place_unique_id"] = place_unique_id;
    global_data["mine_or_other"] = mine_or_other;
    Success2();
	$.ajax({
   type: "POST",
   url: "{% url 'tcgcreator:hand_trigger'  %}",
   data: "room_number={{room_number}}&trigger_id="+trigger_id+"&hand_id="+hand_id+"&place_unique_id="+place_unique_id+"&mine_or_other="+mine_or_other,
success: function(data){
    if(data == "waiting"){
        clearTimeout(timer);
	    timer = setTimeout(sendHandTrigger,1000);
	    return;
    }else{
	    sendHandTriggerDet(data);
	}
   },
   error:function(){
		alert("error");
	}

 });
}
function sendMultipleAnswer(answer){
    if(answer == undefined){
        answer = global_data;
    }
    global_data = answer;
	answer = JSON.stringify(answer);
    Success2();
	$.ajax({
   type: "POST",
   url: "{% url 'tcgcreator:multiple_answer'  %}",
   data: "room_number={{room_number}}&answer="+answer,
success: function(data){
	if(data == "error"){
		ask();
		return;
	}
    if(data == "waiting"){
        clearTimeout(timer);
	    timer = setTimeout(sendMultipleAnswer,1000);
	    return;
    }else{
	    Success(data);
	}
   },
   error:function(){
		alert("error");
	}

 });
}
function sendAnswerOrder(){
    var result = "";
    for(var i=0;i<global_order.length;i++){
        result += String(i) + "_";
    }
    result = result.substr(0,result.length-1);
    Success2();
	$.ajax({
   type: "POST",
   url: "{% url 'tcgcreator:answerorder'  %}",
   data: "room_number={{room_number}}&order="+result,
success: function(data){
	if(data == "error"){
	    alert("正しい対象を選択してください。");
		ask();
		return;
	}
    if(data == "waiting"){
        clearTimeout(timer);
	    timer = setTimeout(sendAnswer,1000);
	    return;
    }else{
	    Success(data);
	}
   },
   error:function(){
		alert("error");
	}

 });
}
function sendAnswer(){
	var decks = global_ask_decks;
	var graves = global_ask_graves;
	var hands = global_ask_hands;
	var return_value = [];
	var tmp,tmp2;
	var field;
	for(key_all in global_all_result){
		if(global_all_result[key_all]["type"] == "field"){
			tmp2 = global_all_result[key_all]["val"].split("_");
			tmp = {};
			tmp["x"] = tmp2[0];
			tmp["y"] = tmp2[1];
			tmp["place"] = "field";
			return_value.push(tmp);
		}else if(global_all_result[key_all]["type"] == "under"){
			tmp2 = global_all_result[key_all]["val"].split("_");
			tmp = {};
			tmp["x"] = tmp2[0];
			tmp["y"] = tmp2[1];
			tmp["under_id"] = global_all_result[key_all]["under_id"];
			tmp["place"] = "under";
			return_value.push(tmp);
		}else if(global_all_result[key_all]["type"] == "deck"){
			for(var i=0;i<decks.length;i++){
				for(j=0;j<decks[i]["val"];j++){
					if(global_all_result[key_all]["val"] == i+"_"+j){
						tmp = decks[i]["det"][j];
						tmp["deck_id"] = decks[i]["key"];
						tmp["place"] = "deck";;
						return_value.push(tmp);
					}
				}
			}
		}else if(global_all_result[key_all]["type"] == "grave"){
			for(var i=0;i<graves.length;i++){
				for(j=0;j<graves[i]["val"];j++){
					if(global_all_result[key_all]["val"] == i+"_"+j){
						tmp = graves[i]["det"][j];
						tmp["grave_id"] = graves[i]["key"];
						tmp["place"] = "grave";;
						return_value.push(tmp);
					}
				}
			}
		}else if(global_all_result[key_all]["type"] == "hand"){
			for(var i=0;i<hands.length;i++){
				for(j=0;j<hands[i]["val"];j++){
					if(global_all_result[key_all]["val"] == i+"_"+j){
						tmp = hands[i]["det"][j];
						tmp["hand_id"] = hands[i]["key"];
						tmp["place"] = "hand";;
						return_value.push(tmp);
					}
				}
			}
		}
	}
	if(return_value.length <min_equation_number || return_value.length >max_equation_number){
		alert("選択できるのは"+min_equation_number+"以上"+max_equation_number+"以下です");

		return;
	}
	answer = JSON.stringify(return_value);
    Success2();

	$.ajax({
   type: "POST",
   url: "{% url 'tcgcreator:answer'  %}",
   data: "room_number={{room_number}}&answer="+answer,
success: function(data){
	if(data == "error"){
	    alert("正しい対象を選択してください。");
		ask();
		return;
	}
    if(data == "waiting"){
        clearTimeout(timer);
	    timer = setTimeout(sendAnswer,1000);
	    return;
    }else{
	    Success(data);
	}
   },
   error:function(){
		alert("error");
	}

 });
}
function sendFieldTriggerDet(data){
    Success2();
	$.ajax({
   type: "POST",
   url: "{% url 'tcgcreator:battle_det'  %}",
   data: "room_number={{room_number}}",
success: function(data){
    if(data == "waiting"){
        clearTimeout(timer);
	    timer = setTimeout(sendFieldTriger,1000);
	    return;
    }else{
	    Success(data);
	}
   },
   error:function(){
		alert("error");
	}
});
}
function sendHandTriggerDet(data){
    Success2();
	$.ajax({
   type: "POST",
   url: "{% url 'tcgcreator:battle_det'  %}",
   data: "room_number={{room_number}}",
success: function(data){
    console.log(data);
    if(data == "waiting"){
        clearTimeout(timer);
	    timer = setTimeout(sendHandTriggerDet,1000);
	    return;
    }else{
	    Success(data);
	}
   },
   error:function(){
		alert("error");
	}
});
}
function answerDet(data){
    Success2();
	$.ajax({
   type: "POST",
   url: "{% url 'tcgcreator:battle_det'  %}",
   data: "room_number={{room_number}}",
success: function(data){
    if(data == "waiting"){
        clearTimeout(timer);
	    timer = setTimeout(answerDet,1000);
	    return;
    }else{
	    Success(data);
	}
   },
   error:function(){
		alert("error");
	}
});
}
function ask(){
    Success2();
	$.ajax({
   type: "POST",
   url: "{% url 'tcgcreator:ask_place'  %}",
   data: "room_number={{room_number}}",
success: function(data){
    console.log(data);
	ask_det(data);
   },
   error:function(){
		alert("error");
	}

 });
}
function None(){
    Success2();
	$.ajax({
   type: "POST",
   url: "{% url 'tcgcreator:none'  %}",
   data: "room_number={{room_number}}",
success: function(data){
    if(data == "waiting"){
        clearTimeout(timer);
        timer = setTimeout(None,1000);
	    return;
    }else{
	    none(data);
	}
   },
   error:function(){
		alert("error");
	}

 });
}
{% if cheat == True %}
function ChooseCheat(data){
    var cheat_html='<select id="cheat_monster">';
        {% for monster in monsters %}
            cheat_html+='<option value="{{monster.id}}">{{monster.monster_name}}</option>';
            cheat_html+='<option value="{{monster.id}}_bottom">{{monster.monster_name}}_bottom</option>';
        {% endfor %}
    cheat_html+="</select>";
    cheat_html+='<select id="cheat_place">'+data+'</select>';
    cheat_html+='<input type="button" value="選択完了" onclick="SendCheat()">';
    $("#message").html(cheat_html);
}
function SendCheat(){
    var tmp = $("#cheat_place").val();
    tmp = tmp.split("_");
    place = tmp[0];
    deck_id = tmp[1];
    mine_or_other = tmp[2];
    monster_id = $("#cheat_monster").val();
	$.ajax({
   type: "POST",
   url: "{% url 'tcgcreator:cheat'  %}",
   data: "room_number={{room_number}}&place="+place+"&deck_id="+deck_id+"&mine_or_other="+mine_or_other+"&monster_id="+monster_id,
success: function(data){
	    Success(data);
   },
   error:function(){
		alert("error");
	}
});
}
function Cheat(){
        clearTimeout(timer);
	$.ajax({
   type: "POST",
   url: "{% url 'tcgcreator:get_place_kind'  %}",
   data: "mode=1",
success: function(data){
	    ChooseCheat(data);
   },
   error:function(){
		alert("error");
	}
});
}
{% endif %}
function Cancel(){
    Success2();
	$.ajax({
   type: "POST",
   url: "{% url 'tcgcreator:cancel'  %}",
   data: "room_number={{room_number}}",
success: function(data){
    if(data == "waiting"){
        clearTimeout(timer);
        timer = setTimeout(Cancel,1000);
	    return;
    }else{
	    cancel(data);
    }
   },
   error:function(){
		alert("error");
	}
});

}
    function PlaySoundEffect(audio_name){
        if(sound_effect_name != audio_name){
            sound_effect.src = static_url+"/audio/"+audio_name;
            sound_effect_name = audio_name;
            sound_effect.repeat = false;
            sound_effect.play();
        }
    }
    function PlayMusic(audio_name){
        if(audio_name != music_name){
            music.pause();
            music.src = static_url+"/audio/"+audio_name;
            music_name = audio_name;
            music.play();
        }
    }
    // 表示するために二つ目の関数を作る
	function Success2(){
	    $("#own_player").html("");
	    $("#other_player").html("");
	    if(stored_data == null){
	        return;
	    }
	    data = stored_data;
	MakeHands(data,1);
	MakeFields(data,data["koka"],1);
    $("#choices").html("");
    $("#message").html("処理中ですしばらくお待ちください");

}
	function Success(data){
	data = JSON.parse(data);
	console.log(data);
	$("#own_player").html("");
	$("#other_player").html("");
	MakeLeftColumn(data);
	MakeOpponentHands(data);
	MakeRightColumn(data);
	MakeChoices(data);
	MakeNone(data);
	if(data["winner"] == true){
		$("#back").show();
		$("#choices").html("");
    }
	if(data["ask"] != false){
	koka = data["koka"];
	stored_data =data;
	PlayMusic(data["audio"]);
	$("#message").html("");
	MakeHands(data,1);
	MakeFields(data,koka,0);
	WriteLog(data);
		ask();
		return;
	}else if(data["ask_org"] == true ){
	koka = data["koka"];
	stored_data =data;
	PlayMusic(data["audio"]);
	$("#message").html("");
	MakeHands(data,1);
	MakeFields(data,koka,0);
	WriteLog(data);
    clearTimeout(timer);
	timer = setTimeout(Wait,5000);
	return;
	}
	if(data["appoint"] == false ){
	    stored_data =data;
	    Success2();
	    WriteLog(data);
        $("#message").html("相手入力待ちです。");
        clearTimeout(timer);
	    timer = setTimeout(Wait,5000);
	    return;
	}
	koka = data["koka"];
	stored_data =data;
	PlayMusic(data["audio"]);
	$("#message").html("");
	MakeHands(data,0);
	MakeFields(data,koka,0);
	WriteLog(data);
}
    function WriteLog(data){
        log = data["log"].replace(/\n/g,"<br>");
        $("#log").html(log);
        $("#log2").html(log);
        message_log = data["message_log"].replace(/\n/g,"<br>");
        $("#message_log").html(message_log);

    }
	function MakeNone(data){
		if(data["pri"] == false){
			return;
		}
		var html = $("#choices").html();
		html += '<input type="button" value="優先権を放棄" onclick ="None()">';
		$("#choices").html(html);
	}
	function MakeChoices(data){
		var i;
		var html="";
		if(data["choices"] == null){
    		$("#choices").html("");
			return;
		}
		for(i=0;i<data["choices"].length;i++){
			html += '<input type="button" value="'+data["choices"][i]["sentence"]+'" onclick ="InvokeChoice('+data["choices"][i]["id"]+')">';

		}
		$("#choices").html(html);

	}
	function ShowFieldMuptiple(place_unique_id){
		var fields = global_field_fields;
		var x,y;
		var i;
		for(x = 0;x<fields.length;x++){
			for(y = 0;y<fields[x].length;y++){
				if(fields[x][y]["det"] == null){
				}else{
					if(fields[x][y]["det"]["place_unique_id"] == place_unique_id){
						result="<table><tr><td><a target=\"_blank\" href=\"{% url "tcgcreator:explain" %}?id="+fields[x][y]["det"]["id"]+"\"> <img style=\"opacity:0.4:background:gray;"+rotate_css+"\" src=\""+static_url+"/img/"+fields[x][y]["det"]["img"]+"\" width=\"100px\" height=\"140px\" ></a></td></tr>";
					    result+="<tr><td>対象 </td></tr>";
					    result+="</table>";
					    if(user == 1){
						    $("#"+x+"_"+y).html(result);
					    }else{
						    $("#"+x+"_"+({{field_y}}-y-1)).html(result);
					    }
					}
				}
			}
		}
	}
	function MakeFieldsChoose2(x,y){
		var fields = global_field_fields;
		var kind = global_field_kind;
		var mine_or_other = global_field_mine_or_other;
		var user = global_field_user;

		tmp = {};
		tmp["val"] = x+"_"+y;
		tmp["type"] = "field";
		global_all_result.push(tmp);
		global_ask_fields.push(tmp["val"]);
		under_flag = false;
		if(global_all_result.length == max_equation_number){
			sendAnswer();
		}
		if((user == 2 && mine_or_other == "1") || (user == 1 && mine_or_other=="2")){
			mine_or_other = 2;
		}else if((user == 2 && mine_or_other == "2") || (user == 1 && mine_or_other=="1")){
			mine_or_other = 1;
		}else if((user == 2 && mine_or_other == "4") || (user == 1 && mine_or_other=="5")){
			mine_or_other = 2;
			under_flag = true;
		}else if((user == 2 && mine_or_other == "5") || (user == 1 && mine_or_other=="4")){
			mine_or_other = 1;
			under_flag = true;
		}else if(mine_or_other == "6"){
			mine_or_other = 0;
			under_flag = true;
		}else{
			mine_or_other = 0;
		}
		var x,y;
		var i;
		for(x = 0;x<fields.length;x++){
			for(y = 0;y<fields[x].length;y++){
                                if(fields[x][y]["mine_or_other"] == user){
                                                        color = mine_color;
                                }else{
                                                color = other_color;
                                }
				if(fields[x][y]["det"] == null){
					if(global_field_whether_monster == 0 && fields[x][y]["kind"].search(String(kind))!=-1 && fields[x][y]["mine_or_other"] == mine_or_other){
						if($.inArray(x+"_"+y,global_ask_fields) != -1){
						    if(user == 1){
						    	$("#"+x+"_"+y).html("");
						    }else{
						    	$("#"+x+"_"+(fields[x].length-y-1)).html("");
						    }

						    continue;

						}
						result="<input type=\"button\" style=\"background-color:"+color+"\" value=\""+global_field_sentence+"\" onclick=\"MakeFieldsChoose2("+x+","+y+")\")>";

						if(user == 1){
							$("#"+x+"_"+y).html(result);
						}else{
							$("#"+x+"_"+({{field_y}}-y-1)).html(result);
						}
					}else{
						if(user == 1){
							$("#"+x+"_"+y).html("");
						}else{
							$("#"+x+"_"+({{field_y}}-y-1)).html("");
						}
					}
				}else{

					if(show_img == false){
					result="<table><tr><td colspan=\"2\">"+fields[x][y]["det"]["monster_name"]+"</td></tr>";
					for(i=0;i<fields[x][y]["det"]["variables"].length;i++){
							result += "<tr><td>"+fields[x][y]["det"]["variables"][i]["name"]+"</td><td>"+fields[x][y]["det"]["variables"][i]["str"]+"</td></tr>";
					}
					}else{

						gray_flag = false;
							if(parseInt(fields[x][y]["det"]["variables"][gray_out]["value"]) >= 1){
								gray_flag = true;
							}else{
								gray_flag = false;
							}
							if(checkVal(fields[x][y]["det"],"rotate")>=1){
                                rotate_css = "transform: rotate(90deg)"
                            }else{
                                rotate_css = "";
                            }
						if(gray_flag == true){
							result="<table><tr><td style=\"background-color:"+color+"\"><a target=\"_blank\" title=\""+fields[x][y]["det"]["monster_sentence"]+"\" href=\"{% url "tcgcreator:explain" %}?id="+fields[x][y]["det"]["id"]+"\"> <img style=\"opacity:0.4:background:gray;"+rotate_css+"\" src=\""+static_url+"/img/"+fields[x][y]["det"]["img"]+"\" width=\"100px\" height=\"140px\" ></a></td></tr>";
						}else{
							result="<table><tr><td style=\"background-color:"+color+"\"><a target=\"_blank\" title=\""+fields[x][y]["det"]["monster_sentence"]+"\" href=\"{% url "tcgcreator:explain"%}?id="+fields[x][y]["det"]["id"]+"\"> <img style=\""+rotate_css+"\" src=\""+static_url+"/img/"+fields[x][y]["det"]["img"]+"\" width=\"100px\" height=\"140px\" ></a></td></tr>";
						}
					}
					if(under_flag == false){
					    if(global_field_whether_monster == 1 && fields[x][y]["kind"].search(String(kind))!=-1 && fields[x][y]["mine_or_other"] == mine_or_other){
					    	if($.inArray(x+"_"+y,global_ask_fields)!= -1){
					    	}else if(Validate(fields[x][y]["det"])){
					    		tmp = {};
					    		tmp["x"] = x;
					    		tmp["y"] = y;
					    		    result+="<tr><td style=\"background-color:"+color+"\"><input type=\"button\" value=\""+global_field_sentence+"\" onclick=\"MakeFieldsChoose2("+x+","+y+")\"></td></tr>";
					    	}
					    }
					}else{
						if(Validate(fields[x][y]["det"])){
							if(fields[x][y]["det"]["under"] != undefined){
	                            under = fields[x][y]["det"]["under"];
	                            for(i=0;i<under.length;i++){
	                                tmp = {};
	                                tmp["x_and_y"] == x+"_"+y;
	                                tmp["under_id"] == under[i]["place_unique_id"];
		                        	if($.inArray(tmp,global_ask_unders)== -1){
		                                result += "<input type=\"button\" onclick=\"ask_det2('under',"+x+","+y+",'"+under[i]["place_unique_id"]+"')\" value=\""+under[i]["monster_name"]+"\">";
		                            }
	                            }

	                        }
						}
					}
					result+="</table>";
					if(user == 1){
						$("#"+x+"_"+y).html(result);
					}else{
						$("#"+x+"_"+({{field_y}}-y-1)).html(result);
					}
				}
			}
		}
	}
	function MakeFieldsChoose(data){
		var tmp;
		var fields = data["field_info"];
		var kind = data["kind"];
		var mine_or_other = data["mine_or_other"];
		var user = data["user"];
		global_field_kind = kind;
		global_field_mine_or_other = mine_or_other;
		global_field_user = user;
		under_flag = false;
		if((user == 2 && mine_or_other == "1") || (user == 1 && mine_or_other=="2")){
			mine_or_other = 2;
		}else if((user == 2 && mine_or_other == "2") || (user == 1 && mine_or_other=="1")){
			mine_or_other = 1;
		}else if((user == 2 && mine_or_other == "4") || (user == 1 && mine_or_other=="5")){
			mine_or_other = 2;
			under_flag = true;
		}else if((user == 2 && mine_or_other == "5") || (user == 1 && mine_or_other=="4")){
			mine_or_other = 1;
			under_flag = true;
		}else if(mine_or_other == "6"){
			mine_or_other = 0;
			under_flag = true;
		}else{
			mine_or_other = 0;
		}
		var x,y;
		var i;
		for(x = 0;x<fields.length;x++){
			for(y = 0;y<fields[x].length;y++){
                                if(fields[x][y]["mine_or_other"] == user){
                                                        color = mine_color;
                                }else {
                                                color = other_color;
                                }
				if(fields[x][y]["det"] == null){
					if($.inArray(x+"_"+y,global_ask_fields2)!= -1 || $.inArray(x+"_"+y,global_ask_fields)!= -1){
					}else{
					    if(global_field_whether_monster == 0 && fields[x][y]["kind"].search(String(kind))!=-1 && fields[x][y]["mine_or_other"] == mine_or_other){
					    	result="<input type=\"button\" style=\"background-color:"+color+"\" value=\""+global_field_sentence+"\" onclick=\"ask_det2('field',"+x+","+y+")\")>";
    						tmp = x+"_"+y;
							global_ask_fields2.push(tmp);

					    	if(user == 1){
					    		$("#"+x+"_"+y).html(result);
					    	}else{
					    		$("#"+x+"_"+({{field_y}}-y-1)).html(result);
					    	}
					    }else{
					    	if(user == 1){
					    		$("#"+x+"_"+y).html("");
					    	}else{
					    		$("#"+x+"_"+({{field_y}}-y-1)).html("");
					    	}
					    }
					}
				}else{
					if($.inArray(x+"_"+y,global_ask_fields2)== -1 && $.inArray(x+"_"+y,global_ask_fields)== -1){
					    if(show_img ==false){
					        result="<table class=\"field\"><tr><td style=\"background-color:"+color+"\"  colspan=\"2\">"+fields[x][y]["det"]["monster_name"]+"</td></tr>";
					        for(i=0;i<fields[x][y]["det"]["variables"].length;i++){
					    		result += "<tr><td style=\"background-color:"+color+"\" >"+fields[x][y]["det"]["variables"][i]["name"]+"</td><td>"+fields[x][y]["det"]["variables"][i]["str"]+"</td></tr>";
					        }
					    }else{
					    	gray_flag = false;
					    	if(parseInt(fields[x][y]["det"]["variables"][gray_out]["value"]) >= 1){
					    		gray_flag = true;
					    	}else{
					    		gray_flag = false;
					    	}
						if(checkVal(fields[x][y]["det"],"rotate")>=1){
                            rotate_css = "transform: rotate(90deg)"
                        }else{
                            rotate_css = ""
                        }
					    	if(gray_flag == true){
					    	    result="<table><tr><td style=\"background-color:"+color+"\" ><a target=\"_blank\" title=\""+fields[x][y]["det"]["monster_sentence"]+"\"  href=\"{% url "tcgcreator:explain"%}?id="+fields[x][y]["det"]["id"]+"\"> <img style=\"opacity:0.4;background:gray;"+rotate_css+"\" width=\"100px\" height=\"140px\" src=\""+static_url+"/img/"+fields[x][y]["det"]["img"]+"\"></a></td></tr>";
					    	}else{
					    	    result="<table><tr><td style=\"background-color:"+color+"\" ><a target=\"_blank\" title=\""+fields[x][y]["det"]["monster_sentence"]+"\" href=\"{% url "tcgcreator:explain"%}?id="+fields[x][y]["det"]["id"]+"\"> <img width=\"100px\" height=\"140px\" style=\""+rotate_css+"\" src=\""+static_url+"/img/"+fields[x][y]["det"]["img"]+"\"></a></td></tr>";
					    	}
					    }
					    if(global_field_whether_monster== 1 && fields[x][y]["kind"].search(String(kind))!=-1 && fields[x][y]["mine_or_other"] == mine_or_other){
					        console.log("PPP");
				    		if(Validate(fields[x][y]["det"])){
					    		tmp = x+"_"+y;
					    		global_ask_fields2.push(tmp);
					    		if(under_flag == false){
					    		    result+="<tr><td style=\"background-color:"+color+"\" ><input type=\"button\" value=\""+global_field_sentence+"\" onclick=\"ask_det2('field',"+x+","+y+")\"></td></tr>";
					    		}else{
							        if(fields[x][y]["det"]["under"] != undefined){
	                                    under = fields[x][y]["det"]["under"];
	                                    for(i=0;i<under.length;i++){
	                                        tmp = {};
	                                        tmp["x_and_y"] == x+"_"+y;
	                                        tmp["under_id"] == under[i]["place_unique_id"];
		                                	if($.inArray(tmp,global_ask_unders)== -1){
		                                        result += "<input type=\"button\" style=\"background-color:"+color+"\"  onclick=\"ask_det2('under',"+x+","+y+",'"+under[i]["place_unique_id"]+"')\" value=\""+under[i]["monster_name"]+"\">";
		                                    }
	                                    }
	                                }
                                }
	                        }
					    }
					    result+="</table>";
					    if(user == 1){
					    	$("#"+x+"_"+y).html(result);
					    }else{
						    $("#"+x+"_"+({{field_y}}-y-1)).html(result);
				        }
					}
				}
			}
		}
	}
	function MakeFields(data,koka,success2){
		var fields = data["field_info"];
	    global_field_fields = fields;
		var user = data["user"];
		var x,y;
		var i,j;
		var relation;
		for(x = 0;x<fields.length;x++){
			for(y = 0;y<fields[x].length;y++){
                                if(fields[x][y]["mine_or_other"] == user){
                                                        color = mine_color;
                                }else {
                                                color = other_color;
                                }
				if(fields[x][y]["det"] == null){
					if(fields[x][y]["hide"] == true){
					if(user == 1){
						$("#"+x+"_"+y).html('<div style="width:100px;height:140px;background-color:black"></div>');
					}else{
						$("#"+x+"_"+(fields[x].length-y-1)).html('<div style="width:100px;height:140px;background-color:black"></div>');
					}
					}else{
					if(user == 1){
						$("#"+x+"_"+y).html("");
					}else{
						$("#"+x+"_"+({{ field_y}}-y-1)).html("");
					}
					}
				}else{
					if(show_img == false){
					result="<table><tr><td style=\"background-color:"+color+"\"  colspan=\"2\">"+fields[x][y]["det"]["monster_name"]+"</td></tr>";
					for(i=0;i<fields[x][y]["det"]["variables"].length;i++){
							result += "<tr><td style=\"background-color:"+color+"\" >"+fields[x][y]["det"]["variables"][i]["name"]+"</td><td>"+fields[x][y]["det"]["variables"][i]["str"]+"</td></tr>";
					}
					}else{
						gray_flag = false;
						if(parseInt(fields[x][y]["det"]["variables"][gray_out]["value"]) >= 1){
							gray_flag = true;
						}else{
							gray_flag = false;
						}
					    relate_str = "";
					    // オルガネラ等表示
						if(fields[x][y]["det"]["rel"] != undefined){
						    for(relation in  fields[x][y]["det"]["rel"]){

						        for(j=0;j<fields[x][y]["det"]["rel"][relation].length;j++){
                                    relate_str+= fields[x][y]["det"]["rel"][relation][j]["monster"]["det"]["monster_name"]+"<br>";
						        }
						    }
						}
						for(j=0;j<koka.length;j++){
						    if(fields[x][y]["det"]["place_unique_id"] == koka[j]["koka"]["place_unique_id"]){
                                    relate_str+= "効果対象 {{Config.chain_string}}"+koka[j]["chain"]+"<br>";
						    }
						}
						if(checkVal(fields[x][y]["det"],"rotate")>=1){
                            rotate_css = "transform: rotate(90deg)"
                        }else{
                            rotate_css = ""
                        }
						if(gray_flag == true){
							result="<table><tr><td style=\"background-color:"+color+"\" ><a target=\"_blank\" title=\""+fields[x][y]["det"]["monster_sentence"]+"\"  href=\"{% url "tcgcreator:explain"%}?id="+fields[x][y]["det"]["id"]+"\"> <img style=\"opacity:0.4;background:gray;"+rotate_css+"\" width=\"100px\" height=\"140px\" src=\""+static_url+"/img/"+fields[x][y]["det"]["img"]+"\"></a><br>"+relate_str+"</td></tr>";
						}else{
							result="<table><tr><td style=\"background-color:"+color+"\" ><a target=\"_blank\" title=\""+fields[x][y]["det"]["monster_sentence"]+"\" href=\"{% url "tcgcreator:explain"%}?id="+fields[x][y]["det"]["id"]+"\"> <img style=\""+rotate_css+"\" width=\"100px\" height=\"140px\" src=\""+static_url+"/img/"+fields[x][y]["det"]["img"]+"\"></a><br>"+relate_str+"</td></tr>";
						}
					}
					if(fields[x][y]["det"]["trigger"] != undefined && success2 == false){
						for(k=0;k<fields[x][y]["det"]["trigger"].length;k++){
							result += "<br><input type=\"button\" onclick=\"sendFieldTrigger('"+x+"','"+y+"','"+fields[x][y]["det"]["place_unique_id"]+"','"+fields[x][y]["det"]["trigger"][k]["id"]+"',1)\" value=\""+fields[x][y]["det"]["trigger"][k]["name"]+"\">";
						}
					}
					result+="</table>";
					if(user == 1){
						$("#"+x+"_"+y).html(result);
					}else{
						$("#"+x+"_"+({{ field_y}}-y-1)).html(result);
					}
				}
			}
		}
	}
	function MakeHands(data,mode){
		var hands = data["hand_info"];
		var i,j,k;
		var monster_variable;
		var variable_name;
		var img_url;
		var result="<table style=\"display:inline;text-align:center\">";
		for(i=0;i<hands.length;i++){
			if(hands.length!= 1){
				result+="<tr><td colspan=\""+hands[i]["myhandnum"]+"\">"+hands[i]["hand_name"]+"</td></tr>";
			}
			if(hands[i]["commonhandnum"] != undefined){
				continue;
			}
			result+="<tr>";
			for(j=0;j<hands[i]["myhandnum"];j++){

				result+="<td >";
				img_url = hands[i]["myhand"][j]["img"];
				result+="<a target=\"_blank\" title=\""+hands[i]["myhand"][j]["monster_sentence"]+"\"  href=\"{% url "tcgcreator:explain" %}?id="+hands[i]["myhand"][j]["id"]+"\" id=\""+hands[i]["myhand"][j]["place_unique_id"]+"\"><img width=\"100px\" height=\"140px\" src=\""+static_url+"/img/"+img_url+"\"></a>";
				// 選択中は出さない
				if(mode == 0){
				    if(hands[i]["myhand"][j]["trigger"] != undefined){
			            for(k=0;k<hands[i]["myhand"][j]["trigger"].length;k++){
					        result += "<br><input type=\"button\" onclick=\"sendHandTrigger('"+(i+1)+"','"+hands[i]["myhand"][j]["place_unique_id"]+"','"+hands[i]["myhand"][j]["trigger"][k]["id"]+"',1)\" value=\""+hands[i]["myhand"][j]["trigger"][k]["name"]+"\">";
				        }
				    }
				}
				result+="</td>";
			}
			result+="</tr>";


		}
		result+="</table>";
		$("#hands").html(result);
	}

	function MakeOpponentHands(data){
		var hands = data["hand_info"];
		var i,j;
		var result="<table style=\"display:inline;text-align:center\">";
		for(i=0;i<hands.length;i++){
			result += "<tr>"
			if(hands.length!= 1){
				result+="<td>"+hands[i]["hand_name"]+"</td>";
			}
			if(hands[i]["commonhandnum"] != undefined){
				continue;
			}
			if(hands[i]["otherhand"] == undefined){
				result+="<td>";
				for(j=0;j<hands[i]["otherhandnum"];j++){
					result += "■ ";
				}
				result += "</td></tr>";
			}else{
			for(j=0;j<hands[i]["otherhandnum"];j++){

				result+="<td>";
				img_url = hands[i]["otherhand"][j]["img"];
				result+="<a target=\"_blank\" title=\""+hands[i]["otherhand"][j]["monster_sentence"]+"\"  href=\"{% url "tcgcreator:explain"%}?id="+hands[i]["otherhand"][j]["id"]+"\"><img width=\"100px\" height=\"140px\" src=\""+static_url+"/img/"+img_url+"\"></a>";
				if(hands[i]["otherhand"][j]["trigger"] != undefined){
			for(k=0;k<hands[i]["otherhand"][j]["trigger"].length;k++){
					result += "<br><input type=\"button\" onclick=\"sendHandTrigger('"+(i+1)+"','"+hands[i]["otherhand"][j]["place_unique_id"]+"','"+hands[i]["otherhand"][j]["trigger"][k]["id"]+"',1)\" value=\""+hands[i]["otherhand"][j]["trigger"][k]["name"]+"\">";
				}
				}
				result+="</td>";
			}
			result+="</tr>";
			}


		}
		$("#opponent_hands").html(result);
	}


	function MakeLeftColumn(data){
		var decks = data["deck_info"];
		var graves = data["grave_info"];
		//var variables = data["variables"];
		var html="";
		var i,j;

		if(data["turn"] != 0){
			html += "ターン"+ data["user_name"+ data["turn"]]+"<br>" ;
		}
/*
		for(i=0;i<variables.length;i++){
			html+=variables[i]["variable_name"]+"<br>";
			if(variables[i]["common"] == true){
				html+=variables[i]["variable_name"]["value"][0]+"<br>";
			}else{

				html+=data["user_1"]+"<br>";
				html+=variables[i]["variable_name"]["value"][0]+"<br>";
				html+=data["user_2"]+"<br>";
				html+=variables[i]["variable_name"]["value"][1]+"<br>";
			}
		}
*/
		for(i=0;i<decks.length;i++){
			html+=decks[i]["deck_name"]+"<br>";
			if(decks[i]["commondecknum"] != undefined){
				if(decks[i]["commondeck"] != undefined){
					html += decks[i]["deck_name"]+"<br>";
					html += "<a target=\"_blank\" href=\"{% url 'tcgcreator:explain_deck' %}?room_number={{room_number}}&deck="+i+"\">共通</a> "+decks[i]["commondecknum"]+"<br>";
				}else{
					html+=decks[i]["commondecknum"]+"<br>";
				}
			}else{
				if(decks[i]["mydeck"] != undefined){
					html += "<a target=\"_blank\" href=\"{% url 'tcgcreator:explain_deck' %}?room_number={{room_number}}&user_number="+data["user"]+"&deck="+i+"\">"+data["user_name1"]+" "+decks[i]["mydecknum"]+"</a><br>";
					for(j=0;j<decks[i]["mydecknum"];j++){
						if(decks[i]["mydeck"][j]["trigger"] != undefined){
							for(k=0;k<decks[i]["mydeck"][j]["trigger"].length;k++){
								html += "<input type=\"button\" onclick=\"sendDeckTrigger('"+(i+1)+"','"+decks[i]["mydeck"][j]["place_unique_id"]+"','"+decks[i]["mydeck"][j]["trigger"][k]["id"]+"',1)\" value=\""+decks[i]["mydeck"][j]["trigger"][k]["name"]+"\">";
							}
						}
					}
				}else{
					html+=data["user_name1"]+" ";
					html+=decks[i]["mydecknum"]+"<br>";
				}
				if(decks[i]["otherdeck"] != undefined){
					html += "<a target=\"_blank\" href=\"{% url 'tcgcreator:explain_deck' %}?room_number={{room_number}}&user_number="+data["other_user"]+"&deck="+i+"\">"+data["user_name2"]+" "+decks[i]["otherdecknum"]+"</a><br>";
				}else{
					html+=data["user_name2"]+" ";
					html+=decks[i]["otherdecknum"]+"<br>";
				}
			}
		}
		for(i=0;i<graves.length;i++){
			html+=graves[i]["grave_name"]+"<br>";
			if(graves[i]["commongravenum"] != undefined){
				if(graves[i]["commongrave"] != undefined){
					html += graves[i]["grave_name"]+"<br>";
					html += "<a target=\"_blank\" href=\"{% url 'tcgcreator:explain_grave' %}?room_number={{room_number}}&grave="+i+"\">共通</a> "+graves[i]["commongravenum"]+"<br>";
				}
			}else{
				if(graves[i]["mygrave"] != undefined){
					html += "<a target=\"_blank\" href=\"{% url 'tcgcreator:explain_grave' %}?room_number={{room_number}}&user_number="+data["user"]+"&grave="+i+"\">"+data["user_name1"]+" "+graves[i]["mygravenum"]+"</a><br>";
				}else{
					html+=data["user_name1"]+" ";
					html+=graves[i]["mygravenum"]+"<br>";
				}
				if(graves[i]["othergrave"] != undefined){
					html += "<a target=\"_blank\" href=\"{% url 'tcgcreator:explain_grave' %}?room_number={{room_number}}&user_number="+data["other_user"]+"&grave="+i+"\">"+data["user_name2"]+" "+graves[i]["othergravenum"]+"</a><br>";
				}else{
					html+=data["user_name2"]+" ";
					html+=graves[i]["othergravenum"]+"<br>";
				}
			}
		}
		html+="残り時間<br>";
		html+=data["user_name1"]+" ";
		html+=String(parseInt(data["time_1"]))+"<br>";
		html+=data["user_name2"]+" ";
		html+=String(parseInt(data["time_2"]))+"<br>";
	$("#left_column").html(html);

}

	function MakeRightColumn(data){
		var html="";
		var color = "black";
		var turn;
		var user_number = parseInt(data["user"]);
		if(user_number == 1){
			if(data["turn"] == 1){
				turn = 1;
			}else{
				turn = 2;
			}
		}else{

			if(data["turn"] == 2){
				turn = 1;
			}else{
				turn = 2;
			}
		}

		{% for phase in Phases %}
		if(data["phase"] == {{phase.id}} ){
			color = "green";
		}else{
			color = "black";
		}
		html += "<span style=\"color:"+ color+"\">{{phase.phase_name}}</span>";
		html += "<br>";
		{% endfor %}
		var variable_id = [];
		var i=0;
		{% for variable in Variable %}
			html += "{{variable.variable_name}}<br>";
			if({{variable.mine_or_other}} == 1){
				html += data["variable"]["{{variable.variable_name}}"]["value"];
			}else{
				html+=data["user_name1"]+"<br>";
				html += data["variable"]["{{variable.variable_name}}"][data["user"]+"_value"]+"<br>";
				html+=data["user_name2"]+"<br>";
				html += data["variable"]["{{variable.variable_name}}"][data["other_user"]+"_value"]+"<br>";
			}

		{% endfor %}
		{% for variable in VirtualVariable %}
			html += "{{variable.variable_name}}<br>";
			if({{variable.mine_or_other}} == 1){
				html += data["variable"]["{{variable.variable_name}}"]["value"];
			}else{
				html+=data["user_name1"]+"<br>";
				html += data["variable"]["{{variable.variable_name}}"][data["user"]+"_value"]+"<br>";
				html+=data["user_name2"]+"<br>";
				html += data["variable"]["{{variable.variable_name}}"][data["other_user"]+"_value"]+"<br>";
			}

		{% endfor %}


		$("#right_column").html(html);

	}
	function Surrender(){
		if(confirm("本当にサレンダーしますか")){
			SendLose();
		}
	}
	function SendLose(){
	$.ajax({
   type: "POST",
   url: "{% url 'tcgcreator:send_lose'  %}",
   data: "room_number={{room_number}}",
success: function(data){
        switch( {{ room_number}}){
            case 1:
                location.href='{% url 'tcgcreator:watch1'%}';
                break;
            case 2:
                location.href='{% url 'tcgcreator:watch2'%}';
                break;
            case 3:
                location.href='{% url 'tcgcreator:watch3'%}';
                break;
        }
   },
   error:function(){
		alert("error");
	}
	});

	}
	function Validate(monster){
		var name_kind = monster_name_kind;
		var i,j;
		console.log(monster);
		for(i = 0;i<exclude.length;i++){
			if(monster["place_unique_id"] == exclude[i]){
				return false;
			}
		}
		if (flag != false){
                if(flag["operator"] == "="){
                    if(monster["flag"] != parseInt(flag["flag_det"])){
                       return false;
                    }
                }else if(flag["operator"] == "&"){
                    if(monster["flag"] & parseInt(flag["flag_det"]) ==  0){
                        return false;
                    }
                }else if(flag["operator"] == "^"){
                    if(monster["flag"] & parseInt(flag["flag_det"]) != 0){
                        return false;
                    }
                }
		}
		// 難しいので一時的の処置
		return true;
		if (name_kind != ""){
			if(name_kind["operator"] == "="){
				if(monster["monster_name"] != name_kind["monster_name"]){
					return false;
				}
			}else if(name_kind["operator"] == "like"){
				if(monster["monster_name"].search(name_kind["monster_name"]) >-1){
					return false;
				}
			}
		}
		var current_and_or ;
		var current_flag;
		var variable_flag;
		for(var i =0;i<variables.length;i++){
		    current_flag = true;
		    current_and_or = "and";
		    for(var j=0;j<variables[i].length;j++){
		        variable_flag = true;
			    if(variables[i][j]["operator"] == "=" || variables[i][j]["operator"] == "" ){
			        if (variables[i][j]["init"] == 0){
			    	    if( monster["variables"][variables[i][j]["name"]]["value"] != variables[i][j]["num"]){
			    		    variable_flag =  false;
	    	    	    }
	    	        }else if (variables[i][j]["init"] == 1){
			    	    if( monster["variables"][variables[i][j]["name"]]["init_value"] != variables[i][j]["num"]){
			    		    variable_flag =  false;
	    	    	    }
	    	        }else{
			    	    if( monster["variables"][variables[i][j]["name"]]["init_init_value"] != variables[i][j]["num"]){
			    		    variable_flag =  false;
	    	    	    }
	    	        }
			    }else if(variables[i][j]["operator"] == "<=" ){
			        if (variables[i][j]["init"] == 0){
			    	    if( monster["variables"][variables[i][j]["name"]]["value"] > variables[i][j]["num"]){
			    		    variable_flag =  false;
	    	    	    }
	    	        }else if (variables[i][j]["init"] == 1){
			    	    if( monster["variables"][variables[i][j]["name"]]["init_value"] > variables[i][j]["num"]){
			    		    variable_flag =  false;
	    	    	    }
	    	        }else{
			    	    if( monster["variables"][variables[i][j]["name"]]["init_init_value"] > variables[i][j]["num"]){
			    		    variable_flag =  false;
	    	    	    }
	    	        }
			    }else if(variables[i][j]["operator"] == ">=" ){
			        if (variables[i][j]["init"] == 0){
			    	    if( monster["variables"][variables[i][j]["name"]]["value"] < variables[i][j]["num"]){
			    		    variable_flag =  false;
	    	    	    }
	    	        }else if (variables[i][j]["init"] == 1){
			    	    if( monster["variables"][variables[i][j]["name"]]["init_value"] < variables[i][j]["num"]){
			    		    variable_flag =  false;
	    	    	    }
	    	        }else{
			    	    if( monster["variables"][variables[i][j]["name"]]["init_init_value"] < variables[i][j]["num"]){
			    		    variable_flag =  false;
	    	    	    }
	    	        }
			    }else if(variables[i][j]["operator"] == "!=" ){
			        if (variables[i][j]["init"] == 0){
			    	    if( monster["variables"][variables[i][j]["name"]]["value"] == variables[i][j]["num"]){
			    		    variable_flag =  false;
	    	    	    }
	    	        }else if (variables[i][j]["init"] == 1){
			    	    if( monster["variables"][variables[i][j]["name"]]["init_value"] == variables[i][j]["num"]){
			    		    variable_flag =  false;
	    	    	    }
	    	        }else{
			    	    if( monster["variables"][variables[i][j]["name"]]["init_init_value"] == variables[i][j]["num"]){
			    		    variable_flag =  false;
	    	    	    }
	    	        }
	            }
	            if(current_and_or == "and"){
	                if(current_flag == true){
	                        current_flag = variable_flag;
	                }else{
	                        current_flag = false;
	                }
	            }else{
	                if(current_flag == true){
	                        current_flag = true;
	                }else{
	                        current_flag = variable_flag;
	                }
	            }
	            current_and_or = variables[i][j]["and_or"];
	        }
	        if(current_flag == false){
	            return false;
	        }
		}
		return true;
	}
</script>
</head>
<body>
<div id="other_player"></div>
<table id="field" width="100%">
<tr><td id="left_column" valign="top" nowarp="">
	
</td><td align="center" valign="top">
<br><span id="player"></span><br>
<br><span id="opponent_hands"></span><br>
<hr>
{% if field_free == False %}
<table class="field"> 
{% for y in range_y %}
<tr>
{% for x in range_x %}
<td id="{{x}}_{{y}}" class=" {% for tmp in y|get_field:x %} {{tmp}} {% endfor %}">
</td>
{% endfor %}
</tr>
{% endfor %}
{% else %}
{% for y in range_y %}
{% for x in range_x %}
    <div style="float:left" id="{{x}}_{{y}}" class="field {% for tmp in y|get_field:0 %} {{tmp}} {% endfor %}">
    </div>
{% endfor %}
<div style="clear:both"></div>
{% endfor %}
<table class="field"> 
{% endif%}
	
</table>
<div id="own_player"></div>
</td><td id="right_column" align="center" valign="top" nowarp=""></td></tr>
</table >
<hr>
<div style="text-align:center;margin:0 auto" id="hands">

</div>
<div class = "control">
    <table style="margin:auto"><tr><td style="border:1px solid #000000" id="log2"></td><td style="vertical-align:top">
    <div style="text-align:center">
        <span id="end_chain" style="text-align:center"><input type="button" value="{{Config.cancel_name}}" onclick="EndChain()"></span>
        <span id="choices" style="text-align:center"></span>
        {% if cheat == True %}
        <span id="cheat" style="text-align:center"><input type="button" value="チート" onclick="javascript:Cheat()"></span>
        {% endif %}
        <span id="cancel" style="text-align:center"><input type="button" value="キャンセル" onclick="javascript:Cancel()"></span>
        <span id="lose" style="text-align:center"><input type="button" value="降参" onclick="javascript:Surrender()"></span>
        <span  style="text-align:center" id="player2"></span>
    </div>
    <div style="text-align:center">メッセージ送信<input type="text" id="tomessage"><input type="button" onclick="SendMessage();" value="メッセージ送信"></div>
    <div style="text-align:center;margin-bottom:10px"><input type="button" onclick="Wait();" value="更新"></div>
    <div id="back" style="text-align:center;display:none"><a href="{% url 'tcgcreator:choose' %}">戻る</a></div>
    <div id="message" style="text-align:center;border:1px solid"></div>
    <div id="log" style="text-align:center;border:1px solid"></div>
    </td></tr></table>
<div id="timer"></div>
    <div style="text-align:center">
        {% if room_number == 1 %}
        <a target="_blank" href="{% url 'tcgcreator:watch1'  %}">これまでのデュエル内容を確認</a>
        {% elif room_number == 2 %}
        <a target="_blank" href="{% url 'tcgcreator:watch2'  %}">これまでのデュエル内容を確認</a>
        {% elif room_number == 3 %}
        <a target="_blank" href="{% url 'tcgcreator:watch3'  %}">これまでのデュエル内容を確認</a>
        {% endif %}
    </div>
</div>
<div style="border:1px solid #000;text-align:center;height:30px;overflow-y:scroll" id="message2" ></div>

</body>
</html>
